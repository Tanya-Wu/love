<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ‹çˆ±å æœ‰æ¬²æ·±åº¦æµ‹è¯•</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- html2canvas for Screenshot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* åŸºç¡€é‡ç½®ä¸å­—ä½“ä¼˜åŒ– */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background-color: #fdf2f8; /* pink-50 */
            color: #1f2937;
            -webkit-tap-highlight-color: transparent;
        }

        /* éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* åŠ¨ç”»ç±» */
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .slide-up {
            animation: slideUp 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* æŒ‰é’®ç‚¹å‡»æ€ */
        .btn-active:active {
            transform: scale(0.98);
            transition: transform 0.1s;
        }

        /* å¼¹çª—é®ç½©åŠ¨ç”» */
        .modal-enter {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 50é“æµ‹è¯•é¢˜æ•°æ®åº“ ---
        const questionsDB = [
            "å¦‚æœä½ ä¼´ä¾£çš„æ‰‹æœºå“äº†ï¼Œä½ ä¼šæœ‰ä¸€ç§å¼ºçƒˆçš„å†²åŠ¨æƒ³å»çœ‹æ˜¯è°å‘çš„æ¶ˆæ¯ã€‚",
            "ä½ ä¸å–œæ¬¢ä¼´ä¾£æœ‰å¼‚æ€§çŸ¥å·±ï¼Œå³ä½¿ä»–ä»¬è®¤è¯†çš„æ—¶é—´æ¯”ä½ è¿˜é•¿ã€‚",
            "å¦‚æœä¼´ä¾£æ²¡æœ‰ç§’å›ä½ çš„æ¶ˆæ¯ï¼Œä½ ä¼šå¼€å§‹èƒ¡æ€ä¹±æƒ³ã€‚",
            "ä½ å¸Œæœ›çŸ¥é“ä¼´ä¾£æ¯ä¸€åˆ†é’Ÿçš„è¡Œè¸ªã€‚",
            "ä½ ç»å¸¸ç¿»çœ‹ä¼´ä¾£çš„ç¤¾äº¤åª’ä½“åŠ¨æ€ï¼ŒæŸ¥çœ‹ç‚¹èµå’Œè¯„è®ºçš„äººæ˜¯è°ã€‚",
            "ä½ è®¤ä¸ºæ‹çˆ±ä¸­çš„äººåº”è¯¥æ²¡æœ‰ä»»ä½•ç§˜å¯†ã€‚",
            "å¦‚æœä¼´ä¾£æƒ³ç‹¬è‡ªå»æ—…è¡Œï¼Œä½ ä¼šæ„Ÿåˆ°éå¸¸ä¸å®‰æˆ–ç”Ÿæ°”ã€‚",
            "ä½ å¸¸å¸¸æ‹…å¿ƒä¼´ä¾£ä¼šé‡åˆ°æ¯”ä½ æ›´å¥½çš„äººè€Œç¦»å¼€ä½ ã€‚",
            "ä½ ä¸å–œæ¬¢ä¼´ä¾£å¤¸èµå…¶ä»–çš„å¼‚æ€§ã€‚",
            "ä½ å¸Œæœ›ä¼´ä¾£æŠŠæ‰€æœ‰çš„ç©ºé—²æ—¶é—´éƒ½èŠ±åœ¨ä½ èº«ä¸Šã€‚",
            "å¦‚æœä¼´ä¾£å› ä¸ºå·¥ä½œå¿™ç¢Œå¿½ç•¥äº†ä½ ï¼Œä½ ä¼šè§‰å¾—ä»–ä¸çˆ±ä½ äº†ã€‚",
            "ä½ æ›¾ç»å·å·æŸ¥çœ‹è¿‡ä¼´ä¾£çš„æ‰‹æœºæˆ–èŠå¤©è®°å½•ã€‚",
            "ä½ å¾ˆéš¾æ¥å—ä¼´ä¾£æœ‰ä½ ä¸çŸ¥é“çš„è¿‡å»ã€‚",
            "å½“ä¼´ä¾£å’Œæœ‹å‹èšä¼šæ—¶ï¼Œä½ ä¼šè¦æ±‚ä»–/å¥¹éšæ—¶æ‹ç…§æŠ¥å¤‡ã€‚",
            "ä½ è®¤ä¸ºä¼´ä¾£ç©¿ä»€ä¹ˆè¡£æœå‡ºé—¨åº”è¯¥ç»è¿‡ä½ çš„åŒæ„ã€‚",
            "ä½ ç»å¸¸è¯¢é—®ä¼´ä¾£â€œä½ çˆ±ä¸çˆ±æˆ‘â€æ¥è·å¾—ç¡®è®¤ã€‚",
            "å¦‚æœä¼´ä¾£å¯¹ä½ çš„æ€åº¦ç¨å¾®å†·æ·¡ä¸€ç‚¹ï¼Œä½ å°±ä¼šé™·å…¥ç„¦è™‘ã€‚",
            "ä½ ä¸å–œæ¬¢ä¼´ä¾£åœ¨æ²¡æœ‰ä½ çš„æƒ…å†µä¸‹ç©å¾—å¾ˆå¼€å¿ƒã€‚",
            "ä½ è§‰å¾—ä¼´ä¾£çš„ç¤¾äº¤åœˆå­å¤ªå¹¿æ˜¯ä¸€ç§å¨èƒã€‚",
            "ä½ å¸Œæœ›æˆä¸ºä¼´ä¾£ç”Ÿå‘½ä¸­å”¯ä¸€é‡è¦çš„äººï¼Œç”šè‡³è¶…è¿‡äº²äººã€‚",
            "çœ‹åˆ°ä¼´ä¾£å’Œåˆ«äººèŠå¾—å¾ˆæŠ•æœºï¼Œä½ ä¼šæ„Ÿåˆ°å¿ƒé‡Œä¸èˆ’æœã€‚",
            "ä½ ä¼šå› ä¸ºä¼´ä¾£å›å¤åˆ«äººçš„æ¶ˆæ¯æ¯”å›å¤ä½ çš„é•¿è€Œåƒé†‹ã€‚",
            "ä½ å€¾å‘äºå¸®ä¼´ä¾£åšå†³å®šï¼Œå› ä¸ºä½ è§‰å¾—è¿™æ ·å¯¹ä»–/å¥¹å¥½ã€‚",
            "å¦‚æœä¼´ä¾£æ›´æ”¹äº†æ‰‹æœºå¯†ç ï¼Œä½ ä¼šè§‰å¾—ä»–åœ¨éšç’ä»€ä¹ˆã€‚",
            "ä½ ä¸å–œæ¬¢ä¼´ä¾£æåŠå‰ä»»çš„ä»»ä½•äº‹æƒ…ï¼Œå³ä½¿æ˜¯å®¢è§‚è¯„ä»·ã€‚",
            "ä½ è®¤ä¸ºâ€œæŠ¥å¤‡â€æ˜¯æ‹çˆ±ä¸­æœ€åŸºæœ¬çš„ä¹‰åŠ¡ï¼Œå¿…é¡»äº‹æ— å·¨ç»†ã€‚",
            "ä½ æœ‰æ—¶ä¼šæ•…æ„è®©ä¼´ä¾£å«‰å¦’ï¼Œä»¥æµ‹è¯•ä»–å¯¹ä½ çš„åœ¨ä¹ç¨‹åº¦ã€‚",
            "ä½ å¾ˆéš¾ä¿¡ä»»ä¼´ä¾£èº«è¾¹çš„å•èº«å¼‚æ€§åŒäº‹ã€‚",
            "å¦‚æœä¼´ä¾£æƒ³æ‹¥æœ‰ç‹¬å¤„çš„ç©ºé—´ï¼Œä½ ä¼šè§‰å¾—è¿™æ˜¯ä¸€ç§ç–è¿œã€‚",
            "ä½ ä¼šé™åˆ¶ä¼´ä¾£çš„æŸäº›çˆ±å¥½ï¼Œå› ä¸ºé‚£ä¼šå ç”¨ä½ ä»¬ç›¸å¤„çš„æ—¶é—´ã€‚",
            "ä½ ç»å¸¸æ‹¿è‡ªå·±å’Œä¼´ä¾£èº«è¾¹çš„äººåšæ¯”è¾ƒã€‚",
            "ä½ è®¤ä¸ºä¼´ä¾£åº”è¯¥æ— æ¡ä»¶ç«™åœ¨ä½ è¿™è¾¹ï¼Œå³ä½¿ä½ æ˜¯é”™çš„ã€‚",
            "å¦‚æœä¼´ä¾£ä¸æŠŠåˆç…§å‘æœ‹å‹åœˆï¼Œä½ ä¼šéå¸¸ä»‹æ„ã€‚",
            "ä½ å¾ˆéš¾å¿å—ä¼´ä¾£æœ‰ä»»ä½•äº‹æƒ…ç’ç€ä½ ã€‚",
            "ä½ ä¼šåœ¨è„‘æµ·ä¸­é¢„æ¼”ä¼´ä¾£èƒŒå›ä½ çš„åœºæ™¯ï¼Œå¹¶å› æ­¤æ„Ÿåˆ°éš¾è¿‡ã€‚",
            "ä½ è§‰å¾—ä¸ºäº†çˆ±æƒ…ï¼Œç‰ºç‰²ä¸€éƒ¨åˆ†ä¸ªäººè‡ªç”±æ˜¯ç†æ‰€åº”å½“çš„ã€‚",
            "ä½ æ›¾è¦æ±‚ä¼´ä¾£åˆ é™¤æŸäº›ä½ ä¸å–œæ¬¢çš„è”ç³»äººã€‚",
            "ä½ å¯¹ä¼´ä¾£çš„è¡Œè¸ªäº†è§£å¾—è¶Šè¯¦ç»†ï¼Œä½ å°±è¶Šæœ‰å®‰å…¨æ„Ÿã€‚",
            "ä½ è®¤ä¸ºä¸¤ä¸ªäººåœ¨ä¸€èµ·å°±åº”è¯¥å…±äº«è´¦å·å¯†ç ã€‚",
            "ä½ ä¼šå› ä¸ºä¼´ä¾£æ²¡æœ‰æ³¨æ„åˆ°ä½ çš„æ–°å‘å‹æˆ–è¡£æœè€Œç”Ÿæ°”ã€‚",
            "ä½ è§‰å¾—ä¼´ä¾£å¦‚æœä¸å›å¤æ¶ˆæ¯ï¼Œå°±ä¸åº”è¯¥å‘æœ‹å‹åœˆã€‚",
            "ä½ å¾ˆéš¾æ¥å—ä¼´ä¾£åœ¨åµæ¶åé€‰æ‹©å›é¿æˆ–å†·æˆ˜ã€‚",
            "ä½ ä¼šé€šè¿‡ä¼´ä¾£çš„æ¶ˆè´¹è®°å½•æ¥æ¨æ–­ä»–çš„è¡Œè¸ªã€‚",
            "ä½ è®¤ä¸ºä¼´ä¾£ä¸ä»…è¦æ˜¯æ‹äººï¼Œè¿˜è¦æ˜¯ä½ æœ€å¥½çš„æœ‹å‹å’Œå¿ƒç†å’¨è¯¢å¸ˆã€‚",
            "å¦‚æœä¼´ä¾£ç§°èµè·¯äººå¥½çœ‹ï¼Œä½ ä¼šç«‹åˆ»æ„Ÿåˆ°ä¸æ‚¦ã€‚",
            "ä½ ç»å¸¸æ‹…å¿ƒè¿™æ®µå…³ç³»ä¼šçªç„¶ç»“æŸã€‚",
            "ä½ è§‰å¾—ä½ çš„æƒ…ç»ªå®Œå…¨å–å†³äºä¼´ä¾£å¯¹ä½ çš„æ€åº¦ã€‚",
            "ä½ ä¼šå› ä¸ºä¼´ä¾£æ²¡æœ‰åœ¨èŠ‚æ—¥é€å‡ºç¬¦åˆé¢„æœŸçš„ç¤¼ç‰©è€Œè´¨ç–‘æ„Ÿæƒ…ã€‚",
            "ä½ å¸Œæœ›ä¼´ä¾£çš„æœªæ¥è§„åˆ’é‡Œå…¨éƒ¨éƒ½æ˜¯å…³äºä½ çš„ã€‚",
            "ä¸ºäº†ç•™ä½å¯¹æ–¹ï¼Œä½ æ„¿æ„åšä»»ä½•æ”¹å˜ï¼Œç”šè‡³å¤±å»è‡ªæˆ‘ã€‚"
        ];

        // --- ç»“æœåˆ†æé€»è¾‘ ---
        const analyzeResult = (score) => {
            if (score <= 25) {
                return {
                    level: "ä½›ç³»/ç–ç¦»å‹",
                    color: "text-green-600",
                    bg: "bg-green-100",
                    attachment: "å›é¿å‹ä¾æ‹ (Avoidant)",
                    description: "ä½ çš„å æœ‰æ¬²éå¸¸ä½ï¼Œç”šè‡³å¯èƒ½æ˜¾å¾—æœ‰äº›ç–ç¦»ã€‚ä½ éå¸¸çœ‹é‡ä¸ªäººç©ºé—´å’Œç‹¬ç«‹æ€§ï¼Œä¸ä»…ç»™è‡ªå·±ï¼Œä¹Ÿç»™ä¼´ä¾£æå¤§çš„è‡ªç”±ã€‚ä½†è¿™æœ‰æ—¶ä¼šè®©ä¼´ä¾£è§‰å¾—ä½ ä¸å¤Ÿåœ¨ä¹ä»–/å¥¹ã€‚",
                    behavior: "ä½ å‡ ä¹ä»ä¸æŸ¥å²—ï¼Œä¹Ÿä¸ä»‹æ„ä¼´ä¾£æœ‰å¼‚æ€§æœ‹å‹ã€‚å½“ä¼´ä¾£è¡¨ç°å‡ºå¼ºçƒˆçš„ä¾èµ–æ—¶ï¼Œä½ å¯èƒ½ä¼šä¸‹æ„è¯†åœ°æƒ³é€ƒç¦»ã€‚ä½ æ›´å–œæ¬¢â€˜æ­ä¼™è¿‡æ—¥å­â€™èˆ¬çš„è½»æ¾æ¨¡å¼ï¼Œè€Œä¸æ˜¯â€˜å¦‚èƒ¶ä¼¼æ¼†â€™çš„ç²˜è…»ã€‚",
                    partner_suggestion: "é€‚åˆåŒæ ·ç‹¬ç«‹ã€æœ‰è‡ªå·±ç”Ÿæ´»é‡å¿ƒçš„ä¼´ä¾£ï¼ˆå¦‚å®‰å…¨å‹ï¼‰ã€‚è¯·å°½é‡é¿å¼€é‡åº¦ç„¦è™‘å‹ä¼´ä¾£ï¼Œå› ä¸ºä»–ä»¬çš„ç´¢å–ä¼šè®©æ„Ÿåˆ°çª’æ¯ï¼Œè€Œä½ çš„å†·æ·¡ä¼šè®©ä»–ä»¬æŠ“ç‹‚ã€‚",
                    blind_spot: "å®¹æ˜“å› ä¸ºè¿‡äºå¼ºè°ƒè¾¹ç•Œæ„Ÿï¼Œè€Œå¿½ç•¥äº†ä¼´ä¾£çš„æƒ…æ„Ÿè¿æ¥éœ€æ±‚ï¼Œè¢«è¯¯è§£ä¸ºâ€˜å†·æš´åŠ›â€™æˆ–â€˜ä¸çˆ±äº†â€™ã€‚",
                    cause: "å¯èƒ½æºäºåŸç”Ÿå®¶åº­ä¸­è¿‡åº¦çš„ç‹¬ç«‹æ•™è‚²ï¼Œæˆ–è€…æ›¾ç»å†è¿‡è¢«æŸç¼šçš„å…³ç³»ï¼Œå¯¼è‡´ä½ æ½œæ„è¯†é‡ŒæŠ—æ‹’äº²å¯†è¿æ¥å¸¦æ¥çš„è´Ÿæ‹…ã€‚",
                    advice: "é€‚åº¦çš„å æœ‰æ¬²å…¶å®æ˜¯â€˜åœ¨ä¹â€™çš„è¡¨ç°ã€‚å°è¯•å¤šå‘ä¼´ä¾£è¡¨è¾¾ä½ çš„æƒ…æ„Ÿéœ€æ±‚ï¼Œä¸è¦æŠŠâ€˜ç‹¬ç«‹â€™å˜æˆâ€˜å†·æ¼ â€™çš„æŒ¡ç®­ç‰Œã€‚"
                };
            } else if (score <= 50) {
                return {
                    level: "å®‰å…¨/å¹³è¡¡å‹",
                    color: "text-blue-600",
                    bg: "bg-blue-100",
                    attachment: "å®‰å…¨å‹ä¾æ‹ (Secure)",
                    description: "æ­å–œï¼ä½ çš„å æœ‰æ¬²å¤„äºéå¸¸å¥åº·çš„æ°´å¹³ã€‚ä½ ä¿¡ä»»ä¼´ä¾£ï¼Œä¹Ÿè‡ªä¿¡äºè¿™æ®µå…³ç³»ã€‚ä½ æ‡‚å¾—åœ¨äº²å¯†å’Œç‹¬ç«‹ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ï¼Œæ—¢èƒ½äº«å—äºŒäººä¸–ç•Œï¼Œä¹Ÿèƒ½å°Šé‡å½¼æ­¤çš„å·®å¼‚ã€‚",
                    behavior: "ä½ å¶å°”ä¼šåƒé†‹ï¼Œä½†è¿™æ›´å¤šæ˜¯ä¸€ç§æƒ…è¶£è€Œéæ§åˆ¶ã€‚ä½ ä¸éœ€è¦é€šè¿‡æŸ¥çœ‹æ‰‹æœºæ¥è·å¾—å®‰å…¨æ„Ÿã€‚å³ä½¿ä¼´ä¾£çŸ­æš‚å¤±è”ï¼Œä½ ä¹Ÿèƒ½å®‰ç¨³åœ°åšè‡ªå·±çš„äº‹æƒ…ã€‚",
                    partner_suggestion: "ä½ æ˜¯æ‹çˆ±å¸‚åœºçš„â€˜ä¸‡èƒ½é€‚é…è€…â€™ã€‚ä½ èƒ½æ²»æ„ˆç„¦è™‘å‹çš„ä¸å®‰ï¼Œä¹Ÿèƒ½ç”¨è€å¿ƒæ¸©æš–å›é¿å‹çš„å¿ƒã€‚å½“ç„¶ï¼Œæ‰¾ä¸€ä¸ªåŒæ ·çš„å®‰å…¨å‹ä¼´ä¾£ä¼šè®©ä½ çš„ç”Ÿæ´»æœ€è½»æ¾ã€‚",
                    blind_spot: "æœ‰æ—¶å€™ä½ å¯èƒ½è¿‡äºç†æ™ºï¼Œè®¤ä¸ºâ€˜è¿™æ²¡ä»€ä¹ˆå¤§ä¸äº†â€™ï¼Œä»è€Œå¿½ç•¥äº†ä¼´ä¾£å½“ä¸‹çš„æƒ…ç»ªæ³¢åŠ¨ï¼Œè¢«è®¤ä¸ºä¸å¤Ÿæ•æ„Ÿã€‚",
                    cause: "ä½ æ‹¥æœ‰ç¨³å®šçš„è‡ªå°Šä½“ç³»ï¼Œå†…å¿ƒå®‰å…¨æ„Ÿå……è¶³ã€‚è¿™ç§å¥åº·çš„å¿ƒç†çŠ¶æ€é€šå¸¸æºäºè‰¯å¥½çš„æˆé•¿ç¯å¢ƒæˆ–æˆåŠŸçš„è‡ªæˆ‘ç–—æ„ˆã€‚",
                    advice: "ä¿æŒè¿™ç§çŠ¶æ€ã€‚ä½ æ˜¯éå¸¸ç†æƒ³çš„æ‹çˆ±å¯¹è±¡ï¼Œç»§ç»­ç”¨ä½ çš„åŒ…å®¹å’Œä¿¡ä»»å»æ»‹å…»è¿™æ®µå…³ç³»å§ã€‚"
                };
            } else if (score <= 75) {
                return {
                    level: "ç„¦è™‘/ä¾æ‹å‹",
                    color: "text-yellow-600",
                    bg: "bg-yellow-100",
                    attachment: "ç„¦è™‘å‹ä¾æ‹ (Anxious)",
                    description: "ä½ æœ‰è¾ƒå¼ºçš„å æœ‰æ¬²ï¼Œè¿™æºäºä½ å¯¹å…³ç³»çš„é‡è§†ï¼Œä½†ä¹Ÿä¼´éšç€ä¸å®‰å…¨æ„Ÿã€‚ä½ å®¹æ˜“èƒ¡æ€ä¹±æƒ³ï¼Œéœ€è¦ä¼´ä¾£é¢‘ç¹çš„ç¡®è®¤å’Œé™ªä¼´ã€‚ä½ çš„çˆ±å¾ˆçƒ­çƒˆï¼Œä½†æœ‰æ—¶ä¼šè®©äººæ„Ÿåˆ°å‹åŠ›ã€‚",
                    behavior: "ä½ å¯¹ç»†èŠ‚éå¸¸æ•æ„Ÿï¼ˆæ¯”å¦‚å›å¤å¾®ä¿¡çš„å­—æ•°ã€è¯­æ°”ï¼‰ã€‚åµæ¶æ—¶ä½ å€¾å‘äºè¿½ç€å¯¹æ–¹æŠŠè¯è¯´æ¸…æ¥šï¼Œæ— æ³•å¿å—å†·å¤„ç†ã€‚ä½ å®¹æ˜“è‡ªæˆ‘æ„ŸåŠ¨ï¼Œä¹Ÿå®¹æ˜“å› ä¸ºä¸€ç‚¹å°äº‹è§‰å¾—è‡ªå·±è¢«æŠ›å¼ƒã€‚",
                    partner_suggestion: "ä½ éœ€è¦ä¸€ä¸ªæƒ…ç»ªç¨³å®šã€äº‹äº‹æœ‰å›åº”çš„ä¼´ä¾£ã€‚é¿å…æ‰¾å›é¿å‹ä¼´ä¾£ï¼Œé‚£ä¼šå¼€å¯â€˜ä½ è¿½æˆ‘é€ƒâ€™çš„ç—›è‹¦å¾ªç¯ã€‚",
                    blind_spot: "å®¹æ˜“æŠŠâ€˜çˆ±â€™å’Œâ€˜èåˆâ€™æ··æ·†ï¼Œè¯•å›¾é€šè¿‡æ¶ˆç­å½¼æ­¤çš„ç•Œé™æ¥è·å¾—å®‰å…¨æ„Ÿï¼Œè¿™å¾€å¾€ä¼šæŠŠå¯¹æ–¹æ¨å¾—æ›´è¿œã€‚",
                    cause: "å¯èƒ½æºäºå†…å¿ƒæ·±å¤„å¯¹â€˜è¢«æŠ›å¼ƒâ€™çš„ææƒ§ã€‚ä½ ä¹Ÿè®¸æŠŠå¤ªå¤šçš„è‡ªæˆ‘ä»·å€¼æ„Ÿç»‘å®šåœ¨äº†ä¼´ä¾£çš„åé¦ˆä¸Šã€‚",
                    advice: "å»ºç«‹â€˜è‡ªæˆ‘å®‰å…¨æ„Ÿâ€™æ˜¯å…³é”®ã€‚å°è¯•åŸ¹å…»è‡ªå·±çš„å…´è¶£çˆ±å¥½ï¼Œå‡å°‘å¯¹ä¼´ä¾£çš„æƒ…ç»ªä¾èµ–ã€‚è®°ä½ï¼Œä¼´ä¾£çš„ç‹¬å¤„ä¸æ˜¯ä¸çˆ±ä½ ï¼Œè€Œæ˜¯å……ç”µã€‚"
                };
            } else {
                return {
                    level: "æè‡´/æŒæ§å‹",
                    color: "text-red-600",
                    bg: "bg-red-100",
                    attachment: "ææƒ§/ç—´è¿·å‹ (Disorganized/Preoccupied)",
                    description: "ä½ çš„å æœ‰æ¬²éå¸¸å¼ºï¼Œå¯èƒ½å·²ç»å¼€å§‹å½±å“åˆ°å…³ç³»çš„å¥åº·ã€‚ä½ æ¸´æœ›å®Œå…¨æŒæ§ä¼´ä¾£çš„è¡Œè¸ªå’Œæ€æƒ³ï¼Œä»»ä½•é£å¹è‰åŠ¨éƒ½ä¼šå¼•å‘ä½ çš„è­¦è§‰ã€‚è¿™ç§çˆ±å¾€å¾€ä¼´éšç€å¼ºçƒˆçš„ç—›è‹¦å’Œæ§åˆ¶ã€‚",
                    behavior: "ä½ å¯èƒ½è¦æ±‚ä¼´ä¾£åˆ é™¤å¼‚æ€§è”ç³»äººï¼Œå¿…é¡»ç§’å›ä¿¡æ¯ï¼Œç”šè‡³é™åˆ¶å¯¹æ–¹çš„ç¤¾äº¤è‡ªç”±ã€‚ä½ å¾ˆéš¾ä¿¡ä»»å¯¹æ–¹ï¼Œæ€»è§‰å¾—å¦‚æœä¸ä¸¥é˜²æ­»å®ˆï¼Œå¯¹æ–¹å°±ä¼šèƒŒå›ã€‚çˆ±å¯¹ä½ æ¥è¯´ï¼Œæ›´åƒæ˜¯ä¸€åœºå¿…é¡»èµ¢çš„æˆ˜äº‰ã€‚",
                    partner_suggestion: "ä½ éœ€è¦ä¸€ä½åŒ…å®¹æ€§æå¼ºã€ä¸”è¾¹ç•Œæ„Ÿéå¸¸æ¸…æ™°æˆç†Ÿçš„ä¼´ä¾£ï¼Œèƒ½å¤Ÿæ¸©æŸ”åœ°æ¥ä½ä½ çš„æƒ…ç»ªï¼Œä½†åšå®šåœ°æ‹’ç»ä½ çš„æ— ç†æ§åˆ¶ã€‚",
                    blind_spot: "å½“æ§åˆ¶æ¬²è¿‡å¼ºæ—¶ï¼Œçˆ±å°±å˜æˆäº†æ·é”ã€‚ä½ è¶Šæ˜¯æƒ³æŠ“ç´§æ²™å­ï¼Œæ²™å­æµå¤±å¾—è¶Šå¿«ã€‚è¿™ç§é«˜å‹ææ˜“å¯¼è‡´å…³ç³»ç ´è£‚æˆ–èµ°å‘æç«¯ã€‚",
                    cause: "è¿™é€šå¸¸æ˜¯æåº¦ç¼ºä¹å®‰å…¨æ„Ÿçš„è¡¨ç°ï¼Œæˆ–è€…æ›¾ç»å†è¿‡ä¸¥é‡çš„èƒŒå›ã€‚ä½ è¯•å›¾é€šè¿‡â€˜æ§åˆ¶â€™æ¥æ¶ˆé™¤â€˜ä¸ç¡®å®šæ€§â€™å¸¦æ¥çš„ç„¦è™‘ã€‚",
                    advice: "è¿™ç§é«˜å‹çŠ¶æ€ä¼šè®©åŒæ–¹éƒ½çª’æ¯ã€‚å»ºè®®å°è¯•â€˜è¯¾é¢˜åˆ†ç¦»â€™ï¼Œæ„è¯†åˆ°ä¼´ä¾£æ˜¯ç‹¬ç«‹çš„ä¸ªä½“ã€‚å¦‚æœç„¦è™‘æ„Ÿæ— æ³•è‡ªæ§ï¼Œå¯»æ±‚ä¸“ä¸šå¿ƒç†å’¨è¯¢çš„å¸®åŠ©ä¼šéå¸¸æœ‰æ•ˆã€‚"
                };
            }
        };

        // --- ç»„ä»¶ï¼šSVG å›¾æ ‡ ---
        const Icons = {
            Heart: () => <i className="ph-fill ph-heart text-red-500 text-3xl"></i>,
            Lock: () => <i className="ph-fill ph-lock-key text-purple-500 text-3xl"></i>,
            Check: () => <i className="ph-bold ph-check text-white"></i>,
            ArrowRight: () => <i className="ph-bold ph-arrow-right"></i>,
            Warning: () => <i className="ph-fill ph-warning-circle text-orange-500"></i>,
            Chart: () => <i className="ph-fill ph-chart-pie-slice text-blue-500"></i>,
            Brain: () => <i className="ph-fill ph-brain text-pink-500"></i>,
            Leaf: () => <i className="ph-fill ph-plant text-green-500"></i>,
            User: () => <i className="ph-fill ph-user text-indigo-500"></i>,
            Siren: () => <i className="ph-fill ph-siren text-red-500"></i>,
            HeartBreak: () => <i className="ph-fill ph-heart-break text-rose-500"></i>,
            Download: () => <i className="ph-bold ph-download-simple"></i>,
            X: () => <i className="ph-bold ph-x"></i>,
            Spinner: () => <i className="ph-bold ph-spinner animate-spin"></i>,
            Image: () => <i className="ph-fill ph-image"></i>
        };

        // --- ä¸»ç¨‹åº ---
        function App() {
            const [gameState, setGameState] = useState('intro'); // intro, playing, result
            const [currentQIndex, setCurrentQIndex] = useState(0);
            const [answers, setAnswers] = useState([]); // Array of 1-5 scores
            const [finalScore, setFinalScore] = useState(0);
            const topRef = useRef(null);

            const startTest = () => {
                setGameState('playing');
                window.scrollTo(0, 0);
            };

            const handleAnswer = (score) => {
                const newAnswers = [...answers, score];
                setAnswers(newAnswers);

                if (currentQIndex < questionsDB.length - 1) {
                    // ä¸‹ä¸€é¢˜
                    setTimeout(() => {
                        setCurrentQIndex(currentQIndex + 1);
                        if(topRef.current) topRef.current.scrollIntoView({ behavior: 'smooth' });
                    }, 200); 
                } else {
                    // è®¡ç®—ç»“æœ
                    finishTest(newAnswers);
                }
            };

            const finishTest = (finalAnswers) => {
                const totalPoints = finalAnswers.reduce((a, b) => a + b, 0);
                const maxPoints = questionsDB.length * 5;
                const score = Math.round((totalPoints / maxPoints) * 100);
                setFinalScore(score);
                setGameState('result');
                window.scrollTo(0, 0);
            };

            const restart = () => {
                setAnswers([]);
                setCurrentQIndex(0);
                setFinalScore(0);
                setGameState('intro');
            };

            return (
                <div className="min-h-screen max-w-md mx-auto bg-white shadow-xl overflow-hidden relative flex flex-col" ref={topRef}>
                    {/* é¡¶éƒ¨è£…é¥° */}
                    <div className="h-2 bg-gradient-to-r from-pink-400 via-red-400 to-purple-500 w-full shrink-0"></div>

                    {gameState === 'intro' && (
                        <div className="p-8 flex flex-col items-center justify-center min-h-[90vh] fade-in text-center flex-grow">
                            <div className="mb-6 bg-pink-100 p-6 rounded-full animate-bounce">
                                <Icons.Heart />
                            </div>
                            <h1 className="text-3xl font-bold text-gray-800 mb-2">æ‹çˆ±å æœ‰æ¬²<br/>æ·±åº¦æµ‹è¯•</h1>
                            <p className="text-gray-500 mb-8 text-sm">åŸºäºä¾æ‹å¿ƒç†å­¦ â€¢ 50é“ç²¾é€‰æµ‹è¯•é¢˜</p>
                            
                            <div className="bg-gray-50 p-6 rounded-xl text-left text-sm text-gray-600 mb-8 w-full shadow-inner">
                                <p className="mb-2">ğŸ’¡ <strong>æµ‹è¯•è¯´æ˜ï¼š</strong></p>
                                <ul className="list-disc list-inside space-y-1">
                                    <li>æœ¬æµ‹è¯•å…±50é¢˜ï¼Œçº¦éœ€3-5åˆ†é’Ÿã€‚</li>
                                    <li>è¯·æ ¹æ®ä½ çš„<strong>ç¬¬ä¸€ç›´è§‰</strong>å›ç­”ã€‚</li>
                                    <li>æ²¡æœ‰å¯¹é”™ä¹‹åˆ†ï¼Œè¯šå®é¢å¯¹è‡ªå·±ã€‚</li>
                                </ul>
                            </div>

                            <button 
                                onClick={startTest}
                                className="w-full bg-gradient-to-r from-pink-500 to-red-500 text-white font-bold py-4 rounded-xl shadow-lg transform transition active:scale-95 flex items-center justify-center gap-2 text-lg btn-active"
                            >
                                å¼€å§‹æµ‹è¯• <Icons.ArrowRight />
                            </button>
                            <p className="mt-6 text-xs text-gray-400">æœ¬æµ‹è¯•ç»“æœä»…ä¾›å‚è€ƒï¼Œä¸å¯ä½œä¸ºä¸“ä¸šè¯Šæ–­ä¾æ®</p>
                        </div>
                    )}

                    {gameState === 'playing' && (
                        <div className="p-6 min-h-screen flex flex-col fade-in flex-grow">
                            {/* è¿›åº¦æ¡ */}
                            <div className="mb-8">
                                <div className="flex justify-between text-xs text-gray-400 mb-2">
                                    <span>è¿›åº¦</span>
                                    <span>{currentQIndex + 1} / {questionsDB.length}</span>
                                </div>
                                <div className="h-2 w-full bg-gray-100 rounded-full overflow-hidden">
                                    <div 
                                        className="h-full bg-pink-500 transition-all duration-300 ease-out"
                                        style={{ width: `${((currentQIndex + 1) / questionsDB.length) * 100}%` }}
                                    ></div>
                                </div>
                            </div>

                            {/* é—®é¢˜å¡ç‰‡ */}
                            <div className="flex-grow flex flex-col justify-center mb-8">
                                <div className="bg-white">
                                    <span className="inline-block px-3 py-1 bg-pink-100 text-pink-600 rounded-full text-xs font-bold mb-4">
                                        Q{currentQIndex + 1}
                                    </span>
                                    <h2 className="text-xl font-medium text-gray-800 leading-relaxed min-h-[80px]">
                                        {questionsDB[currentQIndex]}
                                    </h2>
                                </div>
                            </div>

                            {/* é€‰é¡¹æŒ‰é’® */}
                            <div className="space-y-3 mt-auto pb-8">
                                {[
                                    { text: "éå¸¸ç¬¦åˆ", score: 5, color: "border-red-200 bg-red-50 text-red-700" },
                                    { text: "æ¯”è¾ƒç¬¦åˆ", score: 4, color: "border-pink-200 bg-pink-50 text-pink-700" },
                                    { text: "ä¸€èˆ¬ / ä¸ç¡®å®š", score: 3, color: "border-gray-200 bg-gray-50 text-gray-700" },
                                    { text: "æ¯”è¾ƒä¸ç¬¦åˆ", score: 2, color: "border-blue-200 bg-blue-50 text-blue-700" },
                                    { text: "å®Œå…¨ä¸ç¬¦åˆ", score: 1, color: "border-green-200 bg-green-50 text-green-700" }
                                ].map((option) => (
                                    <button
                                        key={option.score}
                                        onClick={() => handleAnswer(option.score)}
                                        className={`w-full py-4 px-6 border-2 rounded-xl text-left font-medium transition-all duration-200 active:scale-95 btn-active flex justify-between items-center group hover:shadow-md ${option.color} border-transparent`}
                                    >
                                        {option.text}
                                        <span className="w-4 h-4 rounded-full border border-current opacity-30 group-active:bg-current"></span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}

                    {gameState === 'result' && (
                        <ResultPage score={finalScore} onRestart={restart} />
                    )}

                    {/* Intro å’Œ Playing é¡µé¢çš„é€šç”¨ Footer */}
                    {gameState !== 'result' && (
                        <div className="py-6 text-center shrink-0 bg-white">
                            <p className="text-[10px] text-gray-400 font-light tracking-wide">
                                å°çº¢ä¹¦-å¿ƒçµæ –æ¯æ ‘åŸåˆ› ä¾µæƒå¿…ç©¶
                            </p>
                        </div>
                    )}
                </div>
            );
        }

        // --- ç»“æœé¡µç»„ä»¶ ---
        function ResultPage({ score, onRestart }) {
            const result = analyzeResult(score);
            const reportRef = useRef(null);
            const [isGenerating, setIsGenerating] = useState(false);
            const [generatedImg, setGeneratedImg] = useState(null);

            const generateReport = async () => {
                if (!reportRef.current) return;
                setIsGenerating(true);
                
                try {
                    // ç­‰å¾…ä¸€å°ä¼šå„¿ç¡®ä¿æ¸²æŸ“
                    await new Promise(resolve => setTimeout(resolve, 100));
                    
                    const canvas = await html2canvas(reportRef.current, {
                        scale: 2, // æé«˜æ¸…æ™°åº¦
                        useCORS: true,
                        backgroundColor: "#ffffff", // ç¡®ä¿èƒŒæ™¯æ˜¯ç™½è‰²çš„
                        logging: false
                    });
                    
                    const imgData = canvas.toDataURL("image/png");
                    setGeneratedImg(imgData);
                } catch (error) {
                    console.error("ç”Ÿæˆå¤±è´¥", error);
                    alert("å›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œè¯·æˆªå±ä¿å­˜");
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="p-0 bg-white fade-in flex-grow flex flex-col relative">
                    
                    {/* --- éœ€è¦è¢«æˆªå›¾çš„åŒºåŸŸ --- */}
                    <div ref={reportRef} className="bg-white pb-8">
                        {/* å¤´éƒ¨å±•ç¤ºåŒº */}
                        <div className="relative bg-gray-900 text-white p-8 pt-12 pb-16 rounded-b-[2.5rem] shadow-xl overflow-hidden">
                            {/* èƒŒæ™¯è£…é¥° */}
                            <div className="absolute top-0 right-0 w-32 h-32 bg-pink-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 transform translate-x-1/2 -translate-y-1/2"></div>
                            <div className="absolute bottom-0 left-0 w-32 h-32 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 transform -translate-x-1/2 translate-y-1/2"></div>
                            
                            <div className="relative z-10 flex flex-col items-center text-center">
                                <h2 className="text-gray-400 text-sm uppercase tracking-wider mb-2">æ‚¨çš„å æœ‰æ¬²æŒ‡æ•°</h2>
                                {/* ä¿®å¤ï¼šä¸ºæˆªå›¾æ¸…æ™°åº¦ï¼Œå»é™¤ text-transparent gradientï¼Œæ”¹ç”¨çº¯è‰² */}
                                <div className="text-7xl font-bold text-pink-300 mb-2 drop-shadow-lg">
                                    {score}
                                </div>
                                <div className={`px-4 py-1 rounded-full text-sm font-bold bg-white/10 backdrop-blur-sm border border-white/20 ${result.color.replace('text-', 'text-white ')}`}>
                                    {result.level}
                                </div>
                            </div>
                        </div>

                        {/* è¯¦ç»†æŠ¥å‘Šå¡ç‰‡ */}
                        <div className="px-6 -mt-8 relative z-20 space-y-6">
                            
                            {/* ä¾æ‹ç±»å‹å¡ç‰‡ */}
                            <div className="bg-white rounded-2xl p-6 shadow-md border border-gray-100">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className="p-2 bg-blue-100 rounded-lg"><Icons.Lock /></div>
                                    <h3 className="font-bold text-gray-800">ä¾æ‹äººæ ¼åˆ†æ</h3>
                                </div>
                                <p className="font-semibold text-lg text-gray-800 mb-2">{result.attachment}</p>
                                <p className="text-gray-600 text-sm leading-relaxed text-justify">
                                    {result.description}
                                </p>
                            </div>

                            {/* æ½œåœ¨è¡Œä¸ºç”»åƒ */}
                            <div className="bg-white rounded-2xl p-6 shadow-md border border-gray-100">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className="p-2 bg-purple-100 rounded-lg"><Icons.User /></div>
                                    <h3 className="font-bold text-gray-800">æ½œåœ¨è¡Œä¸ºç”»åƒ</h3>
                                </div>
                                <p className="text-gray-600 text-sm leading-relaxed text-justify">
                                    {result.behavior}
                                </p>
                            </div>

                            {/* æˆå› åˆ†æ */}
                            <div className="bg-white rounded-2xl p-6 shadow-md border border-gray-100">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className="p-2 bg-pink-100 rounded-lg"><Icons.Brain /></div>
                                    <h3 className="font-bold text-gray-800">æ·±å±‚å¿ƒç†æˆå› </h3>
                                </div>
                                <p className="text-gray-600 text-sm leading-relaxed text-justify">
                                    {result.cause}
                                </p>
                            </div>

                             {/* é€‚åˆçš„ä¼´ä¾£ & é›·åŒº */}
                             <div className="bg-white rounded-2xl p-6 shadow-md border border-gray-100">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className="p-2 bg-yellow-100 rounded-lg"><Icons.Siren /></div>
                                    <h3 className="font-bold text-gray-800">æ‹çˆ±å¯¼èˆª</h3>
                                </div>
                                <div className="space-y-4">
                                    <div>
                                        <h4 className="font-bold text-sm text-gray-700 mb-1 flex items-center gap-1"><Icons.HeartBreak /> é€‚åˆçš„ä¼´ä¾£ï¼š</h4>
                                        <p className="text-gray-600 text-sm">{result.partner_suggestion}</p>
                                    </div>
                                    <div>
                                        <h4 className="font-bold text-sm text-gray-700 mb-1 flex items-center gap-1"><Icons.Warning /> é›·åŒºé¢„è­¦ï¼š</h4>
                                        <p className="text-gray-600 text-sm">{result.blind_spot}</p>
                                    </div>
                                </div>
                            </div>

                            {/* æ‹çˆ±å»ºè®® */}
                            <div className="bg-gradient-to-br from-gray-50 to-pink-50 rounded-2xl p-6 shadow-md border border-pink-100">
                                <div className="flex items-center gap-3 mb-4">
                                    <div className="p-2 bg-green-100 rounded-lg"><Icons.Leaf /></div>
                                    <h3 className="font-bold text-gray-800">å¦‚ä½•è·å¾—æ›´èˆ’é€‚çš„å…³ç³»ï¼Ÿ</h3>
                                </div>
                                <div className="text-gray-700 text-sm leading-relaxed space-y-3">
                                    <p><strong>âœ¨ å»ºè®®ï¼š</strong> {result.advice}</p>
                                    <div className="h-px bg-pink-200/50 w-full my-3"></div>
                                    <p className="text-xs text-gray-500 italic">
                                        â€œå¥åº·çš„çˆ±ä¸æ˜¯æ†ç»‘ï¼Œè€Œæ˜¯ä¸¤ä¸ªè‡ªç”±çµé­‚çš„åŒè¡Œã€‚â€
                                    </p>
                                </div>
                            </div>
                        </div>

                        {/* æˆªå›¾é‡Œçš„æ°´å° */}
                        <div className="pt-8 pb-4 text-center shrink-0">
                            <p className="text-[12px] text-gray-400 font-bold tracking-wide">
                                å°çº¢ä¹¦ - å¿ƒçµæ –æ¯æ ‘ åŸåˆ›
                            </p>
                            <p className="text-[10px] text-gray-300">
                                å…³æ³¨æŸ¥çœ‹æ›´å¤šå¿ƒç†æµ‹è¯•
                            </p>
                        </div>
                    </div>
                    {/* --- æˆªå›¾åŒºåŸŸç»“æŸ --- */}

                    {/* åº•éƒ¨æ“ä½œæ  (ä¸ä¼šè¢«æˆªå›¾) */}
                    <div className="fixed bottom-0 left-0 w-full bg-white/90 backdrop-blur-md p-4 shadow-[0_-5px_20px_rgba(0,0,0,0.05)] border-t border-gray-100 z-40 flex gap-3 pb-8">
                        <button 
                            onClick={onRestart}
                            className="flex-1 bg-gray-100 text-gray-600 font-bold py-3 rounded-xl active:scale-95 transition-transform flex items-center justify-center gap-2"
                        >
                            é‡æ–°æµ‹è¯•
                        </button>
                        <button 
                            onClick={generateReport}
                            disabled={isGenerating}
                            className="flex-1 bg-gradient-to-r from-pink-500 to-purple-500 text-white font-bold py-3 rounded-xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2 disabled:opacity-70"
                        >
                            {isGenerating ? <><Icons.Spinner /> ç”Ÿæˆä¸­...</> : <><Icons.Image /> ä¿å­˜æŠ¥å‘Š</>}
                        </button>
                    </div>
                    
                    {/* å ä½ç¬¦ï¼Œé˜²æ­¢å†…å®¹è¢«å›ºå®šåº•éƒ¨æ é®æŒ¡ */}
                    <div className="h-24 bg-white"></div>

                    {/* å›¾ç‰‡é¢„è§ˆ Modal */}
                    {generatedImg && (
                        <div className="fixed inset-0 z-50 bg-black/80 flex flex-col items-center justify-center p-4 modal-enter" onClick={() => setGeneratedImg(null)}>
                            <div className="bg-white p-2 rounded-2xl max-h-[85vh] overflow-y-auto max-w-sm w-full relative" onClick={e => e.stopPropagation()}>
                                <button 
                                    onClick={() => setGeneratedImg(null)}
                                    className="absolute top-2 right-2 w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center text-gray-500 hover:bg-gray-200 z-10"
                                >
                                    <Icons.X />
                                </button>
                                <img src={generatedImg} alt="æµ‹è¯•æŠ¥å‘Š" className="w-full rounded-xl" />
                                <div className="text-center mt-3 mb-1">
                                    <p className="text-sm font-bold text-gray-800 flex items-center justify-center gap-2">
                                        <Icons.Check /> é•¿æŒ‰å›¾ç‰‡ä¿å­˜åˆ°ç›¸å†Œ
                                    </p>
                                    <p className="text-xs text-gray-400 mt-1">
                                        å³å¯åˆ†äº«åˆ°æœ‹å‹åœˆæˆ–å°çº¢ä¹¦
                                    </p>
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>